function C(){F(),p(),s(),B(),v(),K(z.offsetWidth,z.offsetHeight),o()}function F(){g=new CAV.CanvasRenderer,H(x.renderer)}function H(t){switch(D&&w.removeChild(D.element),t){case m:D=g}D.setSize(z.offsetWidth,z.offsetHeight),w.appendChild(D.element)}function p(){I=new CAV.Scene}function s(){I.remove(h),D.clear(),q=new CAV.Plane(t.width*D.width,t.height*D.height,t.segments,t.slices),y=new CAV.Material(t.ambient,t.diffuse),h=new CAV.Mesh(q,y),I.add(h);var e,i;for(e=q.vertices.length-1;e>=0;e--)i=q.vertices[e],i.anchor=CAV.Vector3.clone(i.position),i.step=CAV.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1)),i.time=Math.randomInRange(0,Math.PIM2)}function B(){var t,e;for(t=I.lights.length-1;t>=0;t--)e=I.lights[t],I.remove(e);for(D.clear(),t=0;t<G.count;t++)e=new CAV.Light(G.ambient,G.diffuse),e.ambientHex=e.ambient.format(),e.diffuseHex=e.diffuse.format(),I.add(e),e.mass=Math.randomInRange(.5,1),e.velocity=CAV.Vector3.create(),e.acceleration=CAV.Vector3.create(),e.force=CAV.Vector3.create()}function K(t,e){D.setSize(t,e),CAV.Vector3.set(L,D.halfWidth,D.halfHeight),s()}function o(){i=Date.now()-n,u(),M(),requestAnimationFrame(o)}function u(){var e,a,n,s,o,l,r,c=t.depth/2;for(CAV.Vector3.copy(G.bounds,L),CAV.Vector3.multiplyScalar(G.bounds,G.xyScalar),CAV.Vector3.setZ(k,G.zOffset),s=I.lights.length-1;s>=0;s--){o=I.lights[s],CAV.Vector3.setZ(o.position,G.zOffset);var m=Math.clamp(CAV.Vector3.distanceSquared(o.position,k),G.minDistance,G.maxDistance),f=G.gravity*o.mass/m;CAV.Vector3.subtractVectors(o.force,k,o.position),CAV.Vector3.normalise(o.force),CAV.Vector3.multiplyScalar(o.force,f),CAV.Vector3.set(o.acceleration),CAV.Vector3.add(o.acceleration,o.force),CAV.Vector3.add(o.velocity,o.acceleration),CAV.Vector3.multiplyScalar(o.velocity,G.dampening),CAV.Vector3.limit(o.velocity,G.minLimit,G.maxLimit),CAV.Vector3.add(o.position,o.velocity)}for(l=q.vertices.length-1;l>=0;l--)r=q.vertices[l],e=Math.sin(r.time+r.step[0]*i*t.speed),a=Math.cos(r.time+r.step[1]*i*t.speed),n=Math.sin(r.time+r.step[2]*i*t.speed),CAV.Vector3.set(r.position,t.xRange*q.segmentWidth*e,t.yRange*q.sliceHeight*a,t.zRange*c*n-c),CAV.Vector3.add(r.position,r.anchor);q.dirty=!0}function M(){D.render(I)}function J(t){var e,i,a=t,n=function(t){for(e=0,l=I.lights.length;l>e;e++)i=I.lights[e],i.ambient.set(t),i.ambientHex=i.ambient.format()},s=function(t){for(e=0,l=I.lights.length;l>e;e++)i=I.lights[e],i.diffuse.set(t),i.diffuseHex=i.diffuse.format()};return{set:function(){n(a[0]),s(a[1])}}}function v(){window.addEventListener("resize",j)}function A(t){CAV.Vector3.set(k,t.x,D.height-t.y),CAV.Vector3.subtract(k,L)}function j(){K(z.offsetWidth,z.offsetHeight),M()}var t={width:1.5,height:1.5,depth:10,segments:12,slices:6,xRange:.8,yRange:.1,zRange:1,ambient:"#525252",diffuse:"#FFFFFF",speed:.0013},G={count:2,xyScalar:1,zOffset:100,ambient:"#27a5fc",diffuse:"#1e9be0",speed:.001,gravity:1200,dampening:.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:!1,draw:!1,bounds:CAV.Vector3.create(),step:CAV.Vector3.create(Math.randomInRange(.2,1),Math.randomInRange(.2,1),Math.randomInRange(.2,1))},m="canvas",E="svg",x={renderer:m},i,n=Date.now(),L=CAV.Vector3.create(),k=CAV.Vector3.create(),z=document.getElementById("container"),w=document.getElementById("anitOut"),D,I,h,q,y,g,r;C();